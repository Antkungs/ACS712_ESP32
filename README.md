# ESP32 Current Monitoring with LINE Notify Alert

โปรเจกต์นี้ใช้ **ESP32** ร่วมกับเซ็นเซอร์วัดกระแสไฟ **ACS712** ในการตรวจจับการใช้ไฟฟ้า (Current) และส่งแจ้งเตือนผ่าน **LINE Notify**  
เมื่อปลั๊กไฟเริ่มใช้งาน, กำลังใช้งานต่อเนื่อง, และหยุดใช้งาน

---

## ฟีเจอร์หลัก

- อ่านค่ากระแสไฟ AC จากเซ็นเซอร์ ACS712 โดยเก็บค่าเฉลี่ยลด Noise  
- คำนวณกำลังไฟฟ้า (Power) จากแรงดันไฟฟ้าคงที่ (230V) และกระแสไฟที่อ่านได้  
- ตรวจจับสถานะการใช้งานปลั๊กไฟโดยตั้งค่า Threshold กระแสไฟ (500mA)  
- แจ้งเตือนผ่าน LINE Notify  
  - แจ้งเตือนครั้งแรกเมื่อเริ่มใช้งาน  
  - แจ้งเตือนซ้ำทุก 5 นาทีหากยังใช้งานอยู่  
  - แจ้งเตือนเมื่อหยุดใช้งาน  

---

## เทคนิคและหลักการทำงาน

### 1. อ่านค่ากระแสไฟจาก ACS712

- ใช้ไลบรารี `ACS712` อ่านค่า Current แบบ AC  
- เก็บตัวอย่าง 100 ครั้งเพื่อหาค่าเฉลี่ย ลดผลกระทบจากสัญญาณรบกวน  
- ใช้ค่า `calibration_factor` เพื่อเทียบเท่าการวัดจริง  
- กำหนด Threshold เพื่อแยกสถานะว่า "ใช้งาน" หรือ "ไม่ใช้งาน"

### 2. คำนวณกำลังไฟฟ้า (Power)

- ใช้สูตร:  
Power (W) = Voltage (V) × Current (A)
- Voltage ตั้งไว้ที่ 230V (แรงดันไฟฟ้าบ้านทั่วไป)  
- Current อ่านมาในหน่วย mA ต้องแปลงเป็น A โดยหาร 1000  

### 3. การแจ้งเตือนผ่าน LINE Notify

- ใช้ HTTP POST ส่งข้อความผ่าน LINE Notify API  
- ส่งข้อความแจ้งเตือนสถานะการใช้งานปลั๊กไฟพร้อมข้อมูลแรงดัน, กระแส, กำลังไฟ  
- มีการหน่วงเวลาแจ้งเตือนซ้ำทุก 5 นาทีหากยังมีการใช้งาน เพื่อไม่ให้แจ้งเยอะเกินไป  
- แจ้งเตือนเมื่อปลั๊กไฟหยุดใช้งานและรีเซ็ตสถานะ

---

## การตั้งค่าและใช้งาน

1. กำหนดค่าต่าง ๆ ในโค้ด:
  - SSID และ Password ของ WiFi  
  - `LINE_USER_ID` และ `LINE_TOKEN` ของบัญชี LINE Notify  
  - ปรับค่าคาลิเบรตของ ACS712 หากจำเป็น

2. อัพโหลดโค้ดลง ESP32 ผ่าน Arduino IDE หรือ PlatformIO

3. เปิด Serial Monitor เพื่อตรวจสอบสถานะการเชื่อมต่อและการอ่านค่าปัจจุบัน

4. เมื่อปลั๊กไฟถูกใช้งาน จะได้รับข้อความแจ้งเตือนผ่าน LINE ตามสถานะที่เปลี่ยนแปลง

---

## ข้อดีของโปรเจกต์นี้

- ใช้งานง่ายด้วย ESP32 และเซ็นเซอร์กระแสไฟราคาถูก  
- ลดปัญหาแจ้งเตือนเกินความจำเป็นด้วยการหน่วงเวลาการแจ้งเตือน  
- ส่งข้อความแจ้งเตือนแบบเรียลไทม์ผ่าน LINE Notify ที่ใช้งานกันแพร่หลาย  
- ปรับแต่งได้ง่ายตามความต้องการ เช่น แก้ Threshold หรือเพิ่มเซ็นเซอร์อื่น ๆ

---

## หมายเหตุ

- ต้องสร้าง LINE Notify Token และ User ID ให้เรียบร้อยก่อนใช้งาน  
- ค่า Calibration Factor อาจต้องปรับตามเซ็นเซอร์และวงจรจริงเพื่อความแม่นยำสูงสุด  
- ควรทดสอบระบบในสภาพแวดล้อมจริงเพื่อความเสถียรของการวัดและแจ้งเตือน

---

ถ้าต้องการให้ช่วยเสริมโค้ดตัวอย่างอื่น ๆ หรือคำแนะนำด้านฮาร์ดแวร์ แจ้งได้เลยครับ!
